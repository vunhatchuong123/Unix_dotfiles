#!/bin/bash

msgTag="mediastate"

function send_notification() {
  volume=$(awk -F"[][]" '/Left:/ { print $2 }' <(amixer sget Master))
	dunstify -a "changevolume" -u low -h string:x-dunst-stack-tag:$msgTag -h int:value:"$volume" "Volume: ${volume}" -t 2000
}

case $1 in
up)
	# Set the volume on (if it was muted)
  amixer -D default sset Master 2%+ unmute
	send_notification $1
	;;
down)
  amixer -D default sset Master 2%- unmute
	send_notification $1
	;;
mute)
  amixer -q set Master toggle
  if [ "$(awk -F"[][]" '/Left:/ { print $4 }' <(amixer sget Master))" == "off" ]; then
		dunstify -a "changevolume" -u low -h string:x-dunst-stack-tag:$msgTag "Muted" -t 2000  
	else
		send_notification up
	fi
	;;
play)
  playerctl play-pause
  if [ "$(playerctl status)" == "Playing" ]; then
		send_notification up
	else
		dunstify -a "changevolume" -u low -h string:x-dunst-stack-tag:$msgTag "Muted" -t 2000  
	fi
  ;;
next)
  playerctl next
	dunstify -a "changevolume" -u low --h string:x-dunst-stack-tag:$msgTag "Next Track" -t 2000  
	;;
previous)
  playerctl previous
	dunstify -a "changevolume" -u low -h string:x-dunst-stack-tag:$msgTag "Previous Track" -t 2000  
	;;
esac
